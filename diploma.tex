\documentclass[12pt,a4paper]{report}

%\usepackage[a4paper]{geometry}
%\usepackage{showframe}
\usepackage[english,russian]{babel}
\usepackage[T1,T2A]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{mathtools}
\usepackage[center]{caption}
\usepackage[caption2]{ccaption}
\usepackage{indentfirst}
\usepackage{setspace}
\usepackage{etoolbox}
\usepackage{todonotes}
\usepackage{url}
\usepackage{algorithm}
\usepackage[noend]{algpseudocode}
\usepackage[hidelinks]{hyperref}

\renewcommand{\contentsname}{Содержание}
\renewcommand{\bibname}{Список литературы}
\renewcommand{\figurename}{Рис.}
\renewcommand{\tablename}{Таблица}
\renewcommand{\abstractname}{Аннотация}
\renewcommand{\partname}{Часть}

\renewcommand{\bottomfraction}{0.5}
\renewcommand{\floatpagefraction}{0.4}
\renewcommand{\textfloatsep}{0.5cm}
\renewcommand{\intextsep}{0.6cm}
\renewcommand{\floatsep}{0.3cm}

\hoffset -1.0cm
\textwidth  16.5cm
\textheight 24cm

% refs
\newcommand\figref[1]{(рис. \ref{#1})}
% for todos
\newcommand\note[1]{\textcolor{red}{(#1)}}
\newcommand\todonote[1]{\note{TODO: #1}}

% Math
\DeclareMathOperator*{\argmax}{arg\,max}
\newcommand*\card[1]{{\mid #1 \mid}}
\newcommand*\mathR[0]{\rm I\!R}

% Algorithm
\makeatletter
\newenvironment{myalgorithm}[1][htb]{%
    \renewcommand{\ALG@name}{Алгоритм}% Update algorithm name
   \begin{algorithm}[#1]%
  }{\end{algorithm}}
\makeatother
\newcommand*\Let[2]{\State #1 $\gets$ #2}

\begin{document}

% Титульный лист
\begin{titlepage}
\par
\vspace*{-4cm}
\begin{center}
{\large

Санкт-Петербургский Государственный Политехнический Университет\\
Институт прикладной математики и механики\\
Кафедра прикладной математики\\

\vspace*{0.5cm}

\begin{flushright}
Диссертация допущена к защите\\
Зав. кафедрой\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \\
\underline{ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ } \\
"\underline{ \ \ \ }"\underline{ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\end{flushright}

\vspace*{2.0cm}

{\Large
  \textbf{
    ДИССЕРТАЦИЯ\\
    на соискание степени МАГИСТРА\\
  }
}
\vspace*{1cm}
\textbf{
  Тема: \emph{метод ранжирования разнородных результатов поиска}\\
}

}

\vspace*{1.5cm}

\begin{flushleft}
Направление: 01.04.02 - Прикладная математика и информатика\\
Магистерская программа: системное программирование\\
\end{flushleft}

\vspace*{1cm}

Выполнил студент гр. 63601/2 \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \underline{ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ } Толмачев А.С.\\
\vspace*{0.3cm}
Руководитель, к.ф.-м.н., доц. \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \underline{ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ } Иванков А.А.
\vspace*{0.5cm}

\vspace*{0.3cm}

\begin{flushleft}
Консультанты:\\
\vspace*{0.3cm}
по вопросам информационного поиска, к.ф.-м.н. \ \ \ \ \ \ \underline{ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ } Кураленок И.Е.\\
\vspace*{0.3cm}
по вопросам охраны труда, к.т.н., доц. \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \underline{ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ } Монашков В.В.
\end{flushleft}

\end{center}
\vfill
\begin{center}
{\large Санкт-Петербург \\ 2015}
\end {center}
\end{titlepage}

\hoffset 0.46cm
\marginparsep 0pt
\oddsidemargin 0pt
\textwidth 16.5cm
\topmargin -1.5cm
\textheight 9.5in
\footskip 40pt
\parindent 1cm

% 1.5 line spacing
%\renewcommand{\baselinestretch}{1.5}
\setstretch{1.5}
% Use 1.0 spacing for chapter headings
\makeatletter
\patchcmd{\@makechapterhead}{\huge}{\setstretch{1.0}\huge}{}{}
\apptocmd{\@makechapterhead}{}{}{}
\makeatother

\pagenumbering{arabic}
\setcounter{tocdepth}{4}
\normalsize

%=================================================================
\renewcommand{\contentsname}{Содержание}
\tableofcontents

%=================================================================
\chapter*{Введение}
\addcontentsline{toc}{chapter}{Введение}

% План:
% Мотивация
% - о важности информационного поиска и поисковых систем
% - о важности задачи ранжирования
% - о развитии поисковых систем (тренд -- внедрение результатов вертикальных поисков) + специализированные результаты для сценариев
% - о задаче ранжирования разнородных результатов

% Важность информации в современном мире -> С развитием информационных технологий стало доступно огромное количество информации, Интернет -> надо искать в этом огромном море информации -> поисковые системы имеют очень большую важность для людей сегодня, стали неотъемлемой частью нашей жизни

C развитием информационных систем и ростом их популярности растет и количество информации, производимой с их помощью. Так, по данным аналитической компании IDC (International Data Corporation) общий объем цифровой информации в мире составил на 2013 год примерно 4.4 зеттабайт\footnote{1 зеттабайт (ЗБ) = 1 триллион гигабайт}, он увеличивается каждый год примерно на 40\% и к 2020 году составит приблизительно 44 зеттабайт \cite{IDC-Analytics}. Существенная доля этой информации -- информация, размещенная во всемирной сети Интернет. Она большей частью неструктурирована и очень разнообразна. Несомненно, без помощи поисковых систем ориентироваться в этом огромном информационном пространстве не представляется возможным. Поэтому системы веб-поиска на сегодняшний день играют очень важную роль в нашей жизни.

C момента своего возникновения веб-поисковые системы активно развиваются. Одно из современных направлений их развития касается смешивания в результатах поиска разнотипной информации. Первые системы поиска в интернете в ответ на запрос выдавали список ссылок на веб-страницы \figref{early-search-engines} \cite{SearchHistory}.
\begin{figure}[]
  \centering
  \includegraphics[height=0.3\textheight]{pics/AltavistaResults.png}
  \includegraphics[height=0.3\textheight]{pics/Google-EarlyResults.png}
  \caption{Страницы результатов поиска системы AltaVista и одной из первых версий системы Google.}
  \label{early-search-engines}
\end{figure}
Такой вид результатов поиска для того времени был естественным, поскольку представляемая в них информация была однотипной.
% достаточно однородной?
% \note{почему?}
% поскольку информация, содержащаяся в интернете на заре его истории, не отличалась большим разнообразием. 
%Ограничение результатов поиска одним типом -- веб-страницами -- было естественным, поскольку в то время интернет по сути представлял собой набор текстовых страниц, ссылающихся друг на друга при помощи гиперссылок \note{не по этому?}. 
Но по мере того, как развивались интернет-технологии и увеличивалось число интернет-пользователей, информация, размещаемая в сети, становилось все более разнообразной. На сегодняшний день это разнообразие огромно: в интернете можно найти музыку, фильмы, новости, тексты книг, научные статьи, программные приложения, кулинарные рецепты, технические характеристики товаров и отзывы о них и т. д. -- все это различные типы информации. В связи с этим получили развитие системы, предназначенные для агрегации и поиска информации определенного типа. К таковым относятся, например, системы поиска изображений, видео-записей, новостей, товаров, музыки. 
Ясно, что такая специализированная система может быть более удобной и полезной для решения поисковой задачи из соответствующей области, чем система общего назначения. 
%которая на любой запрос выдает список интернет-страниц. 
Действительно, если пользователь, к примеру, ищет фотографии Дворцовой площади, то, очевидно, ему будет гораздо удобнее, если в качестве результатов поиска он будет видеть именно фотографии, а не ссылки на веб-страницы -- ему не нужно будет переходить по этим ссылкам и самостоятельно исследовать страницы в поисках фотографий.
Но выбирать каждый раз, к какой из многочисленных специализированных систем обратиться, неудобно. К тому же пользователь может не знать о существовании той или иной специализированной системы, а для каких-то поисковых задач такой системы может и не быть. Поэтому возникает естественное желание, чтобы система веб-поиска сама ``понимала'' запрос пользователя, и выдавала в ответ информацию нужного типа. Однако ограничивать ответ на запрос каким-то одним типом информации также неоправданно -- для решения своей поисковой задачи пользователю может быть полезна информация сразу нескольких типов. Так, например, при поиске информации о музыкальном исполнителе может быть полезна и его биография, и фотографии с ним, и аудио-записи исполняемой им музыки, и видео-сюжеты о нем. Или же поисковый запрос может быть многозначным -- например, по запросу ``политика'' пользователя может интересовать как информация, касающаяся самого термина, так и политические новости. 
Стандартным на сегодняшний день решением является смешивание результатов поиска от разных специализированных систем и представление их вместе с традиционными результатами веб-поиска -- списком ссылок на интернет-страницы. Такое смешивание мы можем наблюдать, пользуясь современными поисковыми системами. Например, в результатах поиска систем Яндекс и Google можно увидеть разнообразные специализированные результаты: на поисковый запрос о картинах -- результаты поиска по изображениям, на запрос об адресе в городе --  интерактивную карту с отмеченным адресом, на запрос о новостях -- результаты поиска по новостям, а на запрос о кафе -- специализированный ответ с найденными заведениями и информацией о них \figref{vertical-results}. 
% Такие специализированные результаты позволяют пользователю получить интересующую его информацию сразу же на странице с результатами поиска или перейти в специализированную поисковую систему и продолжить поиск информации с ее помощью.
Таким образом, результаты поиска могут быть \emph{разнородными}, поскольку могут содержать информацию разных типов.

\begin{figure}[b!]
  \centering
  \includegraphics[height=0.27\textheight]{pics/VerticalResults-Images-Yandex.png}
  \includegraphics[height=0.27\textheight]{pics/VerticalResults-Maps-Yandex.png}
  \vfill\vfill
  \includegraphics[height=0.27\textheight]{pics/VerticalResults-News-Google.png}
  \includegraphics[height=0.27\textheight]{pics/VerticalResults-Places-Google.png}
  \caption{Специализированные ответы в результатах поиска систем Яндекс и Google.}
  \label{vertical-results}
\end{figure}

Процесс обработки поискового запроса можно условно разделить на два этапа: поиск информации, соответствующей запросу, и представление найденной информации.
На первом этапе из всего множества объектов, известных системе, выбираются те, которые по тем или иным критериям соответствуют заданному запросу. На втором этапе множество найденных объектов представляется некоторым образом и выдается пользователю. 
% Результаты поиска, представленные определенным образом, называются \emph{поисковой выдачей}. 
Задача \emph{ранжирования} относится ко второму из этих этапов. Ранжирование -- это упорядочение результатов поиска в соответствии с некоторым принципом \cite{Ashmanov, Liu-LR}. От того, как упорядочены результаты, во многом зависит то, насколько успешно пользователь сможет решить свою поисковую задачу. 
%Например, если результаты представляются в виде списка, то было бы разумно стараться располагать те из них, которые могут быть наиболее полезны пользователю в контексте заданного им запроса, в начале списка, а менее полезные -- в конце.  
Так, например, если пользователь задал запрос ``скалолазание википедия'', то, вероятно, он ищет статью о скалолазании из интернет-энциклопедии Википедия. Если среди найденных результатов эта статья присутствует, то разумно расположить ее первой в списке результатов поиска, чтобы пользователь смог сразу ею воспользоваться. В противном случае ему будет сложнее найти этот результат среди остальных, а если расположить его за пределами первых десяти результатов, то он и вовсе может решить, что эта статья не была найдена. Каждый из специализированных ответов, встраиваемых в результаты поиска, также может быть более или менее полезен пользователю в сравнении с другими результатами при решении своей поисковой задачи. 
%Поэтому их также требуется ранжировать.
Кроме этого, какие-то из специализированных ответов могут быть в принципе не уместны для заданного поискового запроса. Таким образом, возникает задача выбора специализированных результатов для показа по запросу и ранжирования их в поисковой выдаче. 
%При встраивании в результаты поиска специализированных ответов их также требуется ранжировать -- каждый из специализированных ответов может быть более или менее полезен пользователю в сравнении с другими результатами.

Задача ранжирования, возникающая при смешивании специализированных ответов с традиционными результатами веб-поиска, существенно отличается от классической задачи ранжирования \cite{Liu-LR}. 
Во-первых, классическая задача формулируется для однотипных объектов, в то время как в рассматриваемой задаче ранжируемые результаты разнородны.
Во-вторых, специализированные ответы встраиваются только на первую страницу результатов поиска, поэтому количество ранжируемых объектов при этом невелико. Эти отличия, в особенности первое их них, не позволяют применить для решения рассматриваемой задачи существующие методы решения классической задачи. Соответственно, требуется либо их обобщение, либо разработка принципиально новых подходов.

\begin{figure}[t!]
  \centering
  \includegraphics[width=0.9\textwidth]{pics/EntitySearch-Google.png}
  \caption{Поисковая выдача системы Google со специализированным результатом в отдельной колонке.}
  \label{two-coloumn-serp}
\end{figure}

% Разные модели поисковой выдачи, особенности, связанные с этим
Также следует отметить, что список, -- не единственный способ представления результатов поиска. Модели поисковой выдачи могут быть различными. Например, поисковая выдача системы Google для настольных компьютеров имеет две колонки, в левой из которых располагается список результатов, а в правой могут располагаться специализированные ответы \figref{two-coloumn-serp}. А выдача мобильного приложения поисковой системы Яндекс состоит из страниц, каждая из которых может содержать список результатов или специализированные ответы. Набор этих страниц и их порядок зависит от запроса \figref{yandex-mobile-app-serp}. В таких случаях задача ранжирования усложняется и превращается в задачу расположения результатов поиска в соответствии с заданной моделью поисковой выдачи. Это также требует обобщения существующих методов ранжирования.

\begin{figure}[b!]
  \centering
  \includegraphics[width=0.3\textwidth]{pics/MultiPageSerp-Yandex-1.png}
  \includegraphics[width=0.3\textwidth]{pics/MultiPageSerp-Yandex-2.png}
  \includegraphics[width=0.3\textwidth]{pics/MultiPageSerp-Yandex-3.png}
  \caption{Выдача мобильного приложения поисковой системы Яндекс с результатами поиска на отдельных страницах.}
  \label{yandex-mobile-app-serp}
\end{figure}

В данной работе рассматривается задача ранжирования разнородных результатов поиска и предлагается универсальный метод ее решения. Этот метод может быть применен для ранжирования результатов произвольного вида и для разных моделей поисковой выдачи. Также он не требует экспертных оценок, поскольку основывается на поведении пользователей.   \todonote{Описать, что в каком разделе}. 

%=================================================================
\chapter{Обзор литературы}

Задача ранжирования занимает важное место в информационном поиске, и на эту тему имеется достаточно большое количество публикаций. Однако подавляющее большинство из них относится к задаче ранжирования однотипных объектов (классической задаче ранжирования) \cite{Liu-LR}. При встраивании же специализированных ответов в результаты поиска требуется ранжировать разнородные объекты. Это не дает возможности применить имеющиеся методы решения классической задачи -- главным образом потому, что разнородные объекты нельзя описать одним набором признаков. В связи с этим рассматриваемая задача требует отдельных исследований, которых на данный момент пока не так много.

В этой главе сначала даются краткие сведения о классической задаче ранжирования и основных методах ее решения. Затем проводится обзор имеющихся на данный момент публикаций, посвященных ранжированию разнородных результатов.

\section{Классическая задача ранжирования}
\subsection{Формулировка задачи}

\todonote{}

\subsection{Обзор методов решения}

\todonote{}

\section{Ранжирование специализированных ответов}

\subsection{Формулировка задачи}

\todonote{}

\subsection{Обзор методов решения}

Наиболее ранние исследования в области смешивания разнородных результатов поиска касаются встраивания одного конкретного специализированного ответа на первое место в поисковой выдаче \cite{Diaz-News, Konig, Li} и встраивания одного из нескольких специализированных ответов так же на первое место \cite{Arguello-VerticalSelection2009, Arguello-VerticalSelection2010, DiazArguello-VerticalSelection}. Однако подобные методы подходят лишь в тех случаях, когда для заданного запроса уместен только один специализированный результат, и этот результат наиболее подходящий из всех остальных. В более поздних исследованиях рассматривается возможность встраивания специализированных ответов на различные позиции в поисковой выдаче \cite{Lefortier-YandexVideo, Ponnuswami, Arguello-CIKM11, Jie-YahooFederationSystem}. 
%В работе \cite{Lefortier-YandexVideo} исследуется встранивание 
Однако методы, предлагаемые в работах \cite{Lefortier-YandexVideo, Ponnuswami, Arguello-CIKM11} не достаточно универсальны -- они предназначены для встраивания какого-то конкретного специализированного ответа, или существенно зависят от специфики используемых специализированных ответов.
Также методы \cite{Ponnuswami, Arguello-CIKM11} используют экспертные оценки. Это делает их применение дорогостоящим и затрудняет регулярное обновление используемых машинно-обученных моделей, необходимое для учета изменений в потоке поисковых запросов.

\todonote{Расширить обзор подробнее -- сказать подробнее о методах из публикаций}


%=================================================================
\chapter{Описание метода} 
\label{ch:method-descriptions}

\section{Неформальная постановка задачи}
\label{sec:task-informal}

Неформально и в общем виде решаемую задачу можно сформулировать следующим образом:

\vspace{3mm}
\textbf{Дано:} поисковый запрос, разнородные результаты поиска по нему и модель поисковой выдачи.

\textbf{Требуется:} расположить результаты в соответствии с заданной моделью поисковой выдачи таким образом, чтобы максимизировать полезность получаемой выдачи в контексте заданного запроса; допускается использование не всех результатов.
\vspace{3mm}

\noindent Под моделью поисковой выдачи понимается ее структура и ограничения на расположение результатов. Наиболее распространенная модель -- линейная, когда результаты располагаются в виде списка. Ограничения, к примеру, могут запрещать расположение более двух специализированных результатов в списке подряд или задавать, какие типы результатов являются взаимоисключающими, то есть не могут быть добавлены в выдачу одновременно.

Приведем также формулировку частного случая задачи -- для встраивания специализированных результатов при использовании линейной модели поисковой выдачи:

\vspace{3mm}
\textbf{Дано:} поисковый запрос. результаты поиска по нему -- упорядоченный список ссылок на веб-страницы (веб-результаты) и набор специализированных ответов, а также ограничения на расположение специализированных ответов. 

\textbf{Требуется:} выбрать специализированные ответы и встроить их в список веб-результатов с учетом ограничений таким образом, чтобы максимизировать полезность получаемой поисковой выдачи в контексте заданного поискового запроса.
\vspace{3mm}

\noindent В работе преимущественно рассматривается этот частный случай задачи. Однако предлагаемый метод может быть применен и для решения задачи в общем виде.
%\todonote{что-то добавить по задаче?}

Далее в разделе \ref{sec:base-ideas} описываются основные идеи предлагаемого метода. Затем в разделе \ref{sec:utility-criteria} вводится формальный критерий полезности поисковой выдачи, и в разделе \ref{sec:task-formal} приводится формальная постановка задачи. В последующих разделах описываются этапы ее решения.

%Имея постановку задачи в таком неформальном виде, можно обозначить основные идеи ее решения. Затем требуется определить формальный критерий полезности поисковой выдачи, чтобы перейти к решению задачи в формальном виде.

\section{Основные идеи}
\label{sec:base-ideas}

В основе предлагаемого метода для ранжирования разнородных результатов поиска лежат следующие идеи:
\begin{itemize}
\item рассматривать при ранжировании получаемую поисковую выдачу в целом, а не результаты по-отдельности;
\item для оценки полезности поисковой выдачи использовать действия, совершаемые пользователями.
\end{itemize}
В общих чертах метод можно описать следующим образом:
\begin{enumerate}
\item Определить набор действий-индикаторов, совершаемых пользователем на поисковой выдаче, которые свидетельствуют о том, что выданные результаты были полезны, и поиск завершился успешно.
\item Построить модель, которая по поисковой выдаче будет предсказывать, какова вероятность того, что пользователь совершит на ней какое-то из действий-индикаторов.
\item Разработать алгоритм, который будет составлять разные варианты расположения результатов поиска, оценивать для каждого из них с помощью построенной модели вероятность совершения какого-либо из действий-индикаторов, и в качестве результата возвращать тот вариант, для которого оценка этой вероятности наибольшая.
\end{enumerate}
В последующих подразделах дается более подробное описание каждого из намеченных шагов. 

\section{Критерий полезности поисковой выдачи}
\label{sec:utility-criteria}

Как уже отмечалось выше, для оценки полезности поисковой выдачи предлагается ввести набор действий-индикаторов. И затем считать, что выдача была полезна, если пользователь совершил какое-то из этих действий, и была не полезна в противном случае. Выбор набора действий-индикаторов играет основополагающую роль в предлагаемом методе. Состав этого набора в первую очередь зависит от того, какое взаимодействие с тем или иным результатом ожидается от пользователя. Так, например, результат, содержащий видео-запись, предполагает ее просмотр, результат с аудио-записью предполагает ее прослушивание и т.д. Также этот набор зависит от технических возможностей системы логирования пользовательских действий. Выбор тех или иных действий в качестве индикаторов должен следовать из продуктовых особенностей ранжируемых результатов или статистических обоснований.

Основной тип действий, которые пользователь совершает на поисковой выдаче -- это клики по результатам поиска. В работах \cite{Joachims, Fox-LDTClick, White, Kim} исследуется связь между характером поведения пользователя и его удовлетворенностью предоставленными результатами поиска. В этих работах рассматривается следующий эвристический критерий для оценки полезности неспециализированного результата поиска: результат считается полезным пользователю, если он перешел по ссылке и не возвращался на поисковую выдачу в течение $T$ и более секунд, где $T$ -- некоторый порог. В работе \cite{Fox-LDTClick} приводится статистическое обоснование для значения $T=30$. Этот эвристический критерий получил широкое распространение \cite{White, Kim} и называется критерием ``длинного клика'' (long dwell time click). \todonote{подробнее по используемые результаты из статей}

Большинство специализированные ответов, встраиваемых в поисковую выдачу, для взаимодействия также предполагают клик. Кликнув на специализированный ответ, пользователь переходит в соответствующую специализированную поисковую систему или веб-сервис. Это во многом схоже с переходом на веб-страницу. Таким образом, критерий ``длинного клика'' может быть также применен и для оценки полезности специализированных результатов.

На основании этих соображений был выбран набор действий-индикаторов, состоящий из одного элемента -- ``длинного клика''. При таком наборе формальный критерий полезности поисковой выдачи -- это вероятность того, что пользователь совершит ``длинный клик'' по какому-то из результатов. Будем считать, что чем больше эта вероятность, тем полезнее поисковая выдача будет для пользователя. 

\section{Формальная постановка задачи}
\label{sec:task-formal}

Определив формальный критерий полезности поисковой выдачи, рассматриваемую задачу можно сформулировать следующим образом:
\vspace{3mm}

\textbf{Дано:} 
\begin{enumerate}
\item Поисковый запрос $q$. 
\item Упорядоченное множество веб-результатов $W=\{w_1, ..., w_k\}, \ \forall w_i, w_j, 1 \le i < j \le k: \ w_i \prec w_j$.
\item Cпециализированные ответы $K$ типов: \par
$S_1=\{s^{1}_{1}, ..., s^{1}_{k_1}\},$ \par
$...$ \par
$S_K=\{s^{K}_{1}, ..., s^{K}_{k_K}\}$.
\end{enumerate}

\textbf{Требуется:}
построить упорядоченное множество результатов поиска \linebreak $R=\{r_1, ..., r_n\}, \forall r_i, r_j, 1 \le i < j \le n: \ r_i \prec r_j$, такое, что:  
\begin{enumerate}
\item $R \subseteq W \cup \bigcup\limits_{i=1}^{K} S_i$ -- $R$ состоит из веб-результатов и специализированных ответов.
\item $\forall w_i, w_j \in W \ \exists r_l, r_m \in R$, т. ч. $r_l = w_i, r_m = w_j \ \& \ w_i \prec w_j \Leftrightarrow r_l \prec r_m$ -- все веб-результаты из $W$ присутствуют в $R$, и их порядок сохраняется.
\item $R = \argmax\limits_R P(LDTClick \mid (R, q))$ -- $R$ максимизирует вероятность ``длинного клика''.
\end{enumerate}

\todonote{что-то пояснить про постановку?}

%\todonote{обобщить для произвольной модели поисковой выдачи?}

\section{Построение модели оценки полезности поисковой выдачи}

Для решения задачи, сформулированной в конце предыдущего подраздела, требуется построить модель, которая позволит оценивать вероятность ``длинного клика'' для различных вариантов расположений результатов поиска. Эта модель должна принимать на вход поисковый запрос и вариант расположения результатов, и выдавать оценку вероятности ``длинного клика''.

Построение этой модели заключалось в обучении бинарного классификатора. Рассматривалась следующая задача: 
\vspace{3mm}

\textbf{Дано:} множество классов $\mathbb{C} = \{0,1\}$ и обучающая выборка \linebreak $L=\{ (x_1, y_1), ... (x_N, y_N)\}$, где $x_i = (R_i, q_i) \in X$, $X$ -- множество всех возможных  пар $(R, q)$, $y_i = y(x_i) \in \mathbb{C}$. Значение $y(x_i) = 1$  означает, что пользователь, получив в ответ на запрос $q_i$ поисковую выдачу $R_i$, совершил на ней ``длинный клик'', $y(x_i) = 0$ означает обратное.

\textbf{Требуется:}
построить функцию $F: X \rightarrow [0,1]$, такую, что $\forall x \in X$ значение $F(x)$ приближает значение $P(y(x) = 1)$ (вероятность принадлежности $x$ к классу $1$).
\vspace{3mm}

%-требование к вектору признаков
Для обучения классификатора требуется описать пару $(R, q)$ вектором признаков, то есть ввести отображение $f: X \rightarrow \mathR^m$. Набор признаков должен удовлетворять следующим требованиям:
\begin{itemize}
\item наличие признаков, характеризующих как запрос, так и поисковую выдачу;
\item чувствительность к наличию или отсутствию того или иного специализированного ответа;
\item чувствительность к перестановке результатов;
%\item учитывать содержание ранжируемых результатов
\end{itemize} 
%-краткое описание вектора признаков
Использовались признаки следующих видов:
\begin{itemize}
\item характеристики поискового запроса (лексические, тематические, частотные и т.д.);
\item универсальные характеристики содержимого поисковой выдачи (не зависящие от типов представленных результатов):
  \begin{itemize}
  \item характеристики расположения базовых элементов, используемых для представления результатов;
  \item характеристики соответствия фрагментов текста поисковому запросу;  
  \end{itemize}   
\item признаки, характеризующие содержимое используемых специализированных результатов;
\item агрегированные признаки веб-результатов:
  \begin{itemize}
  \item признаки текстовой и ссылочной релевантности;
  \item тематические признаки;
  \item признаки, основанные на поведении пользователя.
  \end{itemize}     
\end{itemize} 

%-о том, какой метод обучения использовался
Для обучения бинарного классификатора использовался метод градиентного бустинга \cite{ESL, MatrixNet, BoostingOverview} на ``забывчивых'' деревьях решений \cite{ODT}.  

\todonote{подробнее: метод обучения, данные для обучения}

\section{Алгоритм ранжирования}

На основании построенной модели был разработан алгоритм для ранжирования разнородных результатов поиска. Основная идея алгоритма состоит в составлении разных вариантов расположения результатов и выборе наилучшего их них в соответствии с используемой моделью оценки полезности поисковой выдачи. Далее приводится общий вариант алгоритма и его вариант с ``жадной'' стратегией расположения специализированных результатов.

\subsection{Базовый алгоритм}

\begin{myalgorithm}[t!]
\caption{Общий алгоритм ранжирования разнородных результатов поиска.}
\label{alg:ranking-general}
\textbf{Вход:} $W, S=\bigcup\limits_{i=1}^{K} S_i, q$ \par
\textbf{Выход:} $R$
\begin{algorithmic}[1]
  \Function{Rank}{$W, S, q$}
    \Let{$R$}{$W$}
    \Let{$p$}{estimate\_ldt\_click\_probability($R$, $q$)}
    \For{$R^{'} \in$ allowed\_orderings($W, S$)}
      \Let{$p^{'}$}{estimate\_ldt\_click\_probability($R^{'}$, $q$)}
      \If{$p^{'} > p$} 
        \Let{$R$}{$R^{'}$}
        \Let{$p$}{$p^{'}$}
      \EndIf
    \EndFor
    \Return{$R$}
\EndFunction
\end{algorithmic}
\end{myalgorithm}

На листинге Алгоритм \ref{alg:ranking-general} представлен псевдокод общего варианта алгоритма.
Здесь функция \textrm{estimate\_ldt\_click\_probability($R$, $q$)} возвращает оценку вероятности ``длинного клика'' при помощи описанной в предыдущем подразделе модели. Функция \linebreak \textrm{allowed\_orderings($W, S$)} выдает возможные варианты расположения результатов поиска (с учетом возможных ограничений). Эти варианты могут генерироваться в соответствии со стратегией полного перебора или какой-либо другой стратегией. От того, как именно генерируются варианты расположения результатов, зависит количество вызовов функции  \textrm{estimate\_ldt\_click\_probability($R$, $q$)} и, соответственно, производительность алгоритма.

\subsection{``Жадный'' вариант алгоритма}

\begin{myalgorithm}[t!]
\caption{``Жадный'' алгоритм ранжирования разнородных результатов поиска.}
\label{alg:ranking-greedy}
\textbf{Вход:} $W, S=\bigcup\limits_{i=1}^{K} S_i, q$ \par
\textbf{Выход:} $R$
\begin{algorithmic}[1]
  \Function{RankGreedy}{$W, S, q$}
    \Let{$R$}{$W$}
    \Let{$p$}{estimate\_ldt\_click\_probability($R$, $q$)}
    \While{$S \neq \emptyset$}
      \Let{$best\_s$}{$nil$}
      \Let{$best\_pos$}{$nil$}
      \For{$s \in S$}
        \For{$pos \in$ allowed\_positions($s, R$)} 
          \Let{$R^{'}$}{insert($R, s, pos$)}        
          \Let{$p^{'}$}{estimate\_ldt\_click\_probability($R^{'}$, $q$)}
          \If{$p^{'} > p$}
            \Let{$best\_s$}{$s$}
            \Let{$best\_pos$}{$pos$}            
            \Let{$p$}{$p^{'}$}
          \EndIf
        \EndFor
      \EndFor
      \If{$best_s \neq nil$}
        \Let{$R$}{insert($R, best\_s, best\_pos$)}
        \Let{$S$}{remove($S, best\_s$)}   
      \Else %\Comment{ни один результат $s \in S$ не увеличивает вероятность ``длинного клика''}
        \Let{$S$}{$\emptyset$}
      \EndIf
    \EndWhile
    \Return{$R$}
\EndFunction
\end{algorithmic}
\end{myalgorithm}

Из соображений производительности при реализации алгоритма было невозможно использовать стратегию полного перебора. 
\todonote{пояснить?}
%\todonote{оценка скорости роста числа комбинаций при полном переборе?} 
Поэтому использовался вариант алгоритма с жадной стратегией расположения специализированных результатов (листинг Алгоритм \ref{alg:ranking-greedy}). Этот вариант алгоритма ранжирует результаты поиска следующим образом. Сначала в множество $R$ добавляются все элементы из множества веб-результатов $W$ (с учетом порядка), и для него оценивается вероятность ``длинного клика''. Затем из множества всех специализированных ответов $S=\bigcup\limits_{i=1}^{K} S_i$ выбирается такой элемент $best\_s$, и для него выбирается такая позиция $best\_pos$, что добавление элемента $best\_s$ на позицию $best\_pos$ в список результатов поиска максимизирует вероятность совершения ``длинного клика''. Если такой элемент нашелся, то он добавляется в $R$ на найденную позицию и удаляется из множества $S$. Затем выбирается следующий элемент из оставшихся в $S$ и т. д. Алгоритм заканчивает свою работу, когда найдены позиции для всех специализированных ответов, или же если добавление ни одного специализированного ответа ни на какую позицию не увеличивает вероятность ``длинного клика''.

В таком варианте алгоритма число вызовов функции \linebreak \textrm{estimate\_ldt\_click\_probability($R$, $q$)} не превосходит $\card{S}^2 (\card{W} + \card{S})$. При $\card{W} = 10, \card{S} \simeq 30$ время работы алгоритма не сказывалось на общем времени обработки поискового запроса.

\todonote{обобщение для произвольной модели поисковой выдачи}

\todonote{обсуждение полученного решения: преимущества/недостатки}

%\section{Уменьшение числа вариантов расположения результатов}

%=================================================================
\chapter{Программная реализация}

\section{Схема системы ранжирования}


\section{Уменьшение числа обращений к поисковым источникам}
%\section{Используемые технологии}

%=================================================================
\chapter{Оценка качества работы метода}

Качество работы метода оценивалось по метрикам, основанным на экспертных оценках и на поведении пользователей. В этой главе дается описание используемых метрик качества и приводятся результаты оценки.

\todonote{пояснить про метрики, основанным на экспертных оценках, и про поведенческие метрики?}

\section{Методы оценки качества поиска}

\subsection{Методы, основанные на экспертных оценках}

Для оценки качества работы метода по экспертным оценкам использовалась метрики точности и полноты показа специализированных ответов \cite{Metrics} и метрика $pfound$ \cite{PFound}. 

Метрика точности показа специализированных ответов -- это среднее отношение числа уместных специализированных ответов, выдаваемых в ответ на запрос, к общему числу выдаваемых специализированных ответов:
\begin{equation}
P_{show} = \frac{1}{\card{Q}} \sum \limits_{q \in Q} \frac{\card{S_{show}^{rel}(q)}}{\card{S_{show}(q)}}.
\end{equation}
Здесь $Q$ -- выборка поисковых запросов, по которым вычисляется метрика, $S_{show}(q)$ -- множество специализированных ответов, показываемых по запросу $q$, $S_{show}^{rel}(q)$ -- множество \emph{уместных} специализированных ответов, показываемых по запросу $q$ \linebreak ($S_{show}^{rel}(q) \subseteq S_{show}(q)$).
Метрика полноты показа специализированных ответов -- это среднее отношение числа уместных специализированных ответов, выдаваемых в ответ на запрос, к общему числу уместных для запроса специализированных ответов: 
\begin{equation}
R_{show} = \frac{1}{\card{Q}} \sum \limits_{q \in Q} \frac{\card{S_{show}^{rel}(q)}}{\card{S^{rel}(q)}}.
\end{equation}
Здесь также $Q$ -- выборка поисковых запросов, по которым вычисляется метрика, \linebreak $S_{show}^{rel}(q)$ -- множество уместных специализированных ответов, показываемых по запросу $q$. А $S^{rel}(q)$ -- множество всех уместных специализированных ответов для запроса $q$ ($S_{show}^{rel}(q) \subseteq S^{rel}(q)$). Уместность специализированных ответов определяется по экспертным оценкам.

Описанные метрики точности и полноты не учитывают позиции, на которых располагаются специализированные результаты. Для оценки качества работы метода с учетом позиций дополнительно использовалась метрика $pfound$ \cite{PFound}. Эта метрика является оценкой вероятности того, что пользователь найдет интересующую его информацию в результатах поиска. 
%Она вычисляется на основании экспертных оценок степени соответствия каждого из выданных результатов заданному запросу. 
Она вводится в рамках следующей модели:
\begin{itemize}
\item пользователь просматривает результаты поиска в списке по порядку;
\item просматривая очередной результат поиска пользователь с некоторой вероятностью, зависящей от релевантности этого результата запросу, может найти интересующую его информацию, и завершить поиск;
\item вероятность просмотра следующего результата зависит от релевантности предыдущего результата и некоторых внешних причин (например, накапливающейся при просмотре результатов усталости). 
\end{itemize}
Значение метрики вычисляется следующим образом:
\begin{equation}
pfound(R, q) = \sum \limits_{i=1}^{n} pLook(r_i) * pRel(r_i, q),
\end{equation}
где $pLook(r_i)$ -- вероятность просмотра $i$-го результата, $pRel(r_i, q)$ -- вероятность того, что пользователь найдет искомую информацию при просмотре $i$-го результата. Значение вероятностного веса $pRel(r_i, q)$ определяется в соответствии с оценкой релевантности, выставленной паре $(r_i, q)$ экспертами (насколько результат $r_i$ соответствует запросу $q$). Значение $pLook(r_i)$ вычисляется по следующей формуле:
\begin{align}
pLook(r_i) = pLook(r_{i-1}) * (1 - &pRel(r_{i-1}, q)) * (1 - pBreak), \quad 2 \leq i \leq n \\
&pLook(r_1) = 1,
\end{align}
где $pBreak$ -- вероятность того, что пользователь завершит поиск после просмотра $(i-1)$-го результата по каким-то внешним причинам (например, из-за утомления). Значение $pBreak$, так же как и значения $pRel(r_i, q)$, является эвристикой.

\subsection{Методы, основанные на поведении пользователей}

\todonote{}

\section{Описание результатов}

Для оценки качества работы метода по точности и полноте показа специализированных результатов была составлена выборка из 20 тыс. запросов, и для нее были собраны экспертные оценки (набор уместных специализированных результатов для каждого запроса). 
\todonote{подробнее}

Качество по метрике $pfound$ оценивалось на выборке запросов, используемой для приемки изменений в алгоритмах ранжирования.
В сравнении с текущим используемым методом предлагаемый метод показал повышение точности показа специализированных результатов на 21.22\% при снижении полноты на 29.21\% и прирост качества по метрике \textit{pfound} на 0.27\%. \todonote{+ результаты online-эксперимента}


\todonote{пояснить результаты -- насколько это хорошо и т.д.}

%=================================================================
\chapter{Вопросы охраны труда}

\section{Общая характеристика санитарно-гигиенических условий труда}
\section{Эргономические требования}
\section{Микроклиматические условия}
\section{Уровень шума}
\section{Системы освещения}
\section{Излучения}
\section{Электробезопасность}
\section{Инженерно-технические мероприятия по созданию благоприятных условий труда}
\section{Методика и приборы контроля параметров среды}

%=================================================================
\chapter*{Заключение}
\addcontentsline{toc}{chapter}{Заключение}

В данной работе предложен новый метод ранжирования разнородных результатов поиска. Его отличительные особенности состоят в следующем:
\begin{itemize}
  \item ранжируемые результаты рассматриваются в совокупности, а не по отдельности;
  \item результаты располагаются в соответствии с критерием полезности, основанным на действиях пользователей на поисковой выдаче. % на странице с результатами поиска?
\end{itemize}
Благодаря этим особенностям метод обладает рядом преимуществ. Во-первых, он универсален: он может быть применен для ранжирования результатов произвольного вида и для разных моделей поисковой выдачи. Во-вторых, он позволяет естественным образом учитывать взаимосвязи между результатами. И в-третьих, он не требует экспертных оценок для обучения. 

% Какие еще преимущества?
% - легкое добавление нового типа результата / результатов от нового источника ?
% Про события, которые считаем успешными?

Предложенный метод был реализован и применен для встраивания 32-х видов специализированных результатов в поисковую выдачу системы Яндекс для мобильных устройств. Встраивались результаты поиска по изображениям, видео, мобильным приложениям, товарам, новостям, результаты гео-поиска и других сервисов компании Яндекс. 

Было оценено качество работы метода по поисковым метрикам, основанным на экспертных оценках и на поведении пользователей. В сравнении с текущим используемым методом было получено улучшение точности показа специализированных результатов на 21.22\% при снижении полноты на 29.21\% и прирост качества по метрике \textit{pfound} на 0.27\%. \todonote{уточнить результаты} \todonote{+ online-метрики}

В процессе реализации метода также была решена задача нахождения заданного числа кандидатов в аргументы максимизации значения функции, представляющей собой ансамбль ``забывчивых'' деревьев решений (oblivious decision trees), по частично вычисленному вектору признаков. Решение этой задачи позволяет избежать обращения к тем поисковым источникам, результаты которых заведомо нерелевантны заданному поисковому запросу. Разработанное решение имеет самостоятельную ценность и может быть применено и в других задачах.

\renewcommand{\bibname}{Список литературы}
\addcontentsline{toc}{chapter}{Список литературы}
\begin{thebibliography}{@}
  \bibitem{Arguello-VerticalSelection2009} J. Arguello, F. Diaz, J. Callan, and J.-F. Crespo. Sources of evidence for vertical selection. // SIGIR 2009, pp. 315–322. ACM, 2009.
  \bibitem{Arguello-VerticalSelection2010} J. Arguello, F. Diaz, and J.-F. Paiement. Vertical selection in the presence of unlabeled verticals. // SIGIR 2010, pp. 691–698. ACM, 2010.
  \bibitem{Arguello-CIKM11} J. Arguello, F. Diaz, and J. Callan. Learning to aggregate vertical results into web search results. // CIKM 2011, pp. 201–210. ACM, 2011.
%  \bibitem{Arguello-Evaluation} J. Arguello, F. Diaz, J. Callan, and B. Carterette. A methodology for evaluating aggregated search results. // ECIR 2011, pp 141–152. Springer Berlin / Heidelberg, 2011.
  \bibitem{Diaz-News}  F. Diaz. Integration of news content into web results. // WSDM 2009, pp. 182–191. ACM, 2009.
  \bibitem{DiazArguello-VerticalSelection} F. Diaz and J. Arguello. Adaptation of offline vertical selection predictions in the presence of user feedback. // SIGIR 2009, pp. 323–330. ACM, 2009.
  \bibitem{Fox-LDTClick} S. Fox, K. Karnawat, M. Mydland, S. Dumais, T. White. Evaluating Implicit Measures to Improve Web Search. // ACM TOIS, 23(2), pp. 147-168, 2005.    
  \bibitem{ESL} T. Hastie, R. Tibshirani, J. Friedman. The Elements of Statistical Learning, 2nd edition. // Springer, 2009.  
  \bibitem{Jie-YahooFederationSystem} L. Jie, S. Lamkhede, R.t Sapra, E. Hsu, H. Song, Y. Chang. A Unified Search Federation System Based on Online User Feedback. // Proceedings of KDD 2013. ACM, 2013.    
  \bibitem{Joachims} T. Joachims. Optimizing Search Engines using Clickthrough Data. // Proceedings of KDD 2002. ACM, 2002.
  \bibitem{Kim} Y. Kim, A. Hassan, R. White, I. Zitouni. Modeling Dwell Time to Predict Click-level Satisfaction. // Proceedings of WSDM 2014.
  \bibitem{ODT} R. Kohavi. Ch. Li. Oblivious Decision Trees, Graphs, and Top-Down Pruning. // IJCAI, pp. 1071-1079, 1995.
  \bibitem{Konig} A. C. K\"{o}nig, M. Gamon, and Q. Wu. Click-through prediction for news queries. // SIGIR 2009, pp. 347–354. ACM, 2009.
  \bibitem{Lefortier-YandexVideo} D. Lefortier, P. Serdyukov, F. Romanenko, M. de Rijke. Blending Vertical and Web results: A Case Study using Video Intent. // ECIR 2014, pp. 184-196.
  \bibitem{Li} X. Li, Y.-Y. Wang, and A. Acero. Learning query intent from regularized click graphs. // SIGIR 2008, pp. 339–346. ACM, 2008.
  \bibitem{Liu-LR} T. Liu. Learning to rank for information retrieval. // Foundations and Trends in Informaton Retrieval, vol. 3, no. 3, pp. 225–331, 2009. 
  \bibitem{Ponnuswami} A. K. Ponnuswami, K. Pattabiraman, Q. Wu,
R. Gilad-Bachrach, and T. Kanungo. On composition of a federated web search result page: Using online users to provide pairwise preference for heterogeneous verticals. //  WSDM 2011, pp. 715–724. ACM, 2011.
  \bibitem{Metrics} M. Sokolova, G. Lapalme. A systematic analysis of performance measures for classification tasks. // Information Processing and Management 45, p. 427–437. Elsevier, 2009.
  \bibitem{White} R. White, J. Huang. Assessing the Scenic Route: Measuring the Value of Search Trails in Web Logs. // Proceedings of SIGIR 2010. ACM 2010.    
\bibitem{Ashmanov} И. Ашманов, А. Иванов. Оптимизация и продвижение сайтов в поисковых системах, 3-е издание. // Спб.: Питер, 2011.
  \bibitem{PFound} А. Гулин, П. Карпович, Д. Расковалов,
И. Сегалович. Оптимизация алгоритмов ранжирования методами машинного обучения. // РОМИП 2009.
  \bibitem{BoostingOverview} А. Фонарев, А. Дьяконов. Обзор алгоритмов бустинга. // МГУ, 2012.
  \bibitem{MatrixNet} Алгоритм машинного обучения MatrixNet. // URL: \url{https://company.yandex.ru/technologies/matrixnet/}. Дата обращения: 3.06.2015.               
\bibitem{IDC-Analytics} International Data Corporation (IDC). The Digital Universe of Opportunities: Rich Data and the Increasing Value of the Internet of Things. // EMC website,
  URL: \url{http://www.emc.com/leadership/digital-universe/2014iview/executive-summary.htm} (дата обращения: 7.05.2015).
\bibitem{SearchHistory} A Brief History of Search Engines. // Webreference website, 
  URL: \url{http://www.webreference.com/authoring/search_history} (дата обращения: 19.05.2015).

\end{thebibliography}

\chapter*{Словарь терминов}
%\addcontentsline{toc}{chapter}{Словарь терминов}

\todonote{дать определение терминам}

Поисковая система?

Поисковый запрос

Поисковая выдача
%Совокупность результатов поиска, выдаваемых поисковой системой в ответ на запрос, представленная определенным образом называется \emph{поисковой выдачей}.
% Совокупность результатов поиска, выдаваемых поисковой системой в ответ на запрос, представленная определенным образом, называется ... образует \emph{поисковую выдачу}.


Поисковый источник

Специализированный ответ (специализированный результат)

Ранжирование

Тип информации

\end{document}


